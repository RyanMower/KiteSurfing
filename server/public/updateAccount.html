<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="Ryan Mower" />
    <title>KiteSurfing - Update Account</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap Icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
    <!-- SimpleLightbox plugin CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <!-- Dynamically Updates Navbar -->
    <script src="js/jquery.js"></script>
    <script src="js/navbar_scripts.js"></script>
    <script src="js/create_account.js"></script>
    <script>
      function showFailure(reason){
        console.log("Inside showFailure");
        var alert_elm = document.getElementById("alert-element");
        alert_elm.classList.value = "alert alert-danger";
        alert_elm.innerHTML = reason;
      }
      
      $(document).ready(function () { 
        $('#UpdateAccount-form').submit(function (event) { 
        event.preventDefault(); 
        //collect the form data using Id Selector for whatever data you need 
        //to send to server 
        let email        = $('#email').val(); 
        let fname        = $('#first-name').val(); 
        let lname        = $('#last-name').val(); 
        let phone_number = $('#phone-number').val(); 
        let pass1        = $('#password1').val(); 
        let pass2        = $('#password2').val(); 
        let post_data = {
            "email": email,
            "first-name"  : fname,
            "last-name"   : lname,
            "phone-number": phone_number,
            "password1"   : pass1,
            "password2"   : pass2
        }
        console.log("Trying to post");
        $.post('/createAccount', 
          post_data, 
            (data) => { 
              if (data.status === 'success') { 
                window.location.href = '/login'; 
              }
              else { 
                if (data.reason === "email-exists"){
                  window.location.href = '/resetPassword'; 
                  return;
                }
                console.log("Calling showFailure");
                //Display error message 
                showFailure(data.reason);
              } 
            }); 
        }); 
      });
    </script>
  </head>
  <body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="loginNav">
      <div class="container px-4 px-lg-5">
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav me-auto my-2 my-lg-0">
            <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            <li class="nav-item active"><a class="nav-link" href="surfing-lessons">Surfing Lessons</a></li>
            <li class="nav-item"><a class="nav-link" href="surfing-locations">Surfing Locations</a></li>
          </ul>
        </div>
        <div id="navbarResponsive">
          <ul class="navbar-nav ms-auto my-2 my-lg-0">
            <li class="nav-item"><a id="login-nav" class="nav-link" href="login">Login</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Create Account -->
    <section class="page-section" id="contact">
      <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
          <div class="col-lg-8 col-xl-6 text-center">
            <h2 class="mt-0">Update Account Here!</h2>
            <hr class="divider" />
          </div>
        </div>
        <div class="row gx-4 gx-lg-5 justify-content-center mb-5">
          <div class="col-lg-6">
            <div id="alert-element"></div>
            <div style="margin:'50px';" class="col-lg-8 box-transparent">
              <table id="user-data-table" class="table table-striped" border="1">
                <form id="UpdateAccount-form" >
                  <!------------------>
                  <tr id="email" class="user-data">
                    <td>
                      <div>Email: </div>
                      <br>
                    </td>
                    <td>
                      <div>${email}</div>
                    </td>
                  </tr>
                  <tr id="fname" class="user-data">
                    <td>
                      <label for="first-name"><b>First Name: </b></label>
                      <br>
                    </td>
                    <td>
                      <input name="first-name" class="form-control" id="first-name" type="text" placeholder="John" required>
                    </td>
                  </tr>
                  <tr id="lname" class="user-data">
                    <td>
                      <label for="last-name"><b>Last Name: </b></label>
                      <br>
                    </td>
                    <td>
                      <input name="last-name" class="form-control" id="first-name" type="text" placeholder="Doe" required>
                    </td>
                  </tr>
                  <tr id="phone" class="user-data">
                    <td>
                      <label for="phone-number"><b>Phone Number</b></label>
                      <br>
                    </td>
                    <td>
                      <input name="phone-number" class="form-control" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" title="Ex. 123-456-7890" id="phone-number" type="tel" placeholder="123-456-7890" required>
                    </td>
                  </tr>
                  <tr id="pass1" class="user-data password-input">
                    <td>
                      <label for="password1">Password</label>
                      <br>
                    </td>
                    <td>
                       <input name="password1" class="form-control password-input" id="password1" type="password" placeholder="Password" required></textarea>
                    </td>
                  </tr>
                  <tr id="pass2" class="user-data password-input">
                    <td>
                      <label for="password2">Re-type Password</label>
                      <br>
                    </td>
                    <td>
                      <input name="password2" class="form-control password-input" id="password2" type="password" placeholder="Password" required></textarea>
                    </td>
                  </tr>
                </form>
              </table>
            </div>
            <br>
            <div id="info-alert-password" class="alert alert-info" hidden>
              Password must include:
              <ul>
                <li>10 characters</li>
                <li>1 number</li>
                <li>1 symbol from ~`!@#$%^&*()_-+={[}]|:;<,>.?</li>
                <li>Passwords must match</li>
              </ul>
            </div>
            <div id="server-password-err" hidden></div>
            <!-- Submit Button -->
            <button class="btn btn-primary" type="submit">Update Account</button>
            </form>
          </div>
        </div>
      </div>
    </section>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SimpleLightbox plugin JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
  </body>
</html>

